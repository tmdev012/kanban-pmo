# Workflow: sprint-retro
# Prefix: sprint | Suffix: retro
# Audit: Weekly retrospective — velocity + burndown
name: sprint-retro

on:
  schedule:
    - cron: '0 16 * * 5'  # Every Friday 4pm UTC
  workflow_dispatch:

permissions:
  contents: read

jobs:
  sprint-retro:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Velocity report
        run: |
          echo "=== Sprint Retro — $(date +%Y-%m-%d) ==="
          COMMITS=$(git log --since="1 week ago" --oneline | wc -l)
          CLOSED=$(git log --since="1 week ago" --diff-filter=A --name-only -- 'kanban/closed/TASK-*.md' | grep -c 'TASK-' || echo 0)
          echo "Commits this week: $COMMITS"
          echo "Cards closed:      $CLOSED"
          echo ""
          echo "--- Remaining WIP ---"
          ls kanban/wip/TASK-*.md 2>/dev/null | wc -l
          echo "--- Remaining Backlog ---"
          ls kanban/backlog/TASK-*.md 2>/dev/null | wc -l

      - name: Log audit trail
        run: |
          echo "$(date -u +%Y-%m-%dT%H:%M:%SZ) sprint-retro completed" >> kanban/exports/audit.log
